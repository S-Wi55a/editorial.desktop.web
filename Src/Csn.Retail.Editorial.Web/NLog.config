<?xml version="1.0" encoding="utf-8" ?>
<nlog xmlns="http://www.nlog-project.org/schemas/NLog.xsd"
      xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
      throwExceptions="true" autoReload="true">

  <!-- See http://nlog-project.org/wiki/Configuration_file for information on customizing logging rules and outputs. -->
  <targets async="true">

    <target type="File" name="CodeProfileLogs" fileName="${basedir}/logs/profile-${shortdate}.log"
            layout="${longdate} ${message}" />

    <target type="File" name="RestRequestLogs" fileName="${basedir}/logs/httprequests-${shortdate}.log"
            layout="${longdate} ${uppercase:${level}} ${logger} ${message} ${onexception:${exception:format=tostring}}" />

    <target type="File" name="FileLog" fileName="${basedir}/logs/${shortdate}.log"
            layout="${longdate} ${uppercase:${level}} ${logger} ${message} ${onexception:${exception:format=tostring}}" />

    <target type="File" name="FileLogCategorised" fileName="${basedir}/logs/${shortdate}-${level}.log"
            layout="${longdate} ${uppercase:${level}} ${message} ${onexception:${exception:format=tostring}}" />

    <target name="HystrixFile"
            type="File"
           fileName="${basedir}/logs/hystrix-${shortdate}.log">
      <layout type="JsonLayout">
        <field Name="Where" layout="${machinename}" />
        <!--<field Name="When" layout="${longdate}" />-->
        <field Name="Duration" layout="${event-context:item=api-duration}" />
        <!--<field Name="Execution" layout="${event-context:item=api-execution}" />
          <field Name="CacheHit" layout="${event-context:item=api-cachehit}" />-->
        <field Name="Status" layout="${event-context:item=api-status}" />
        <field Name="Name" layout="${replace:searchFor=HystrixRestClient\:Get\:http\://:replaceWith=:regex=false:ignoreCase=true:wholeWords=false:inner=${event-context:item=api-name}}" />
      </layout>
    </target>

    <target name="NotFoundArticleLog"
            type="File"
           fileName="${basedir}/logs/notfound-articlelog-${shortdate}.log">
      <layout type="JsonLayout">
        <field Name="When" layout="${longdate}" />
        <field Name="Environment" layout="Production" />
        <field Name="ServerName" layout="${machinename}" />
        <field Name="Browser" layout="${aspnet-request:serverVariable=HTTP_USER_AGENT}" />
        <field name="RequestUrl" layout="${message}" />
        <field name="Referrer" layout="${aspnet-request:serverVariable=HTTP_REFERER}" />
        <field name="IPLocation" layout="T:${aspnet-request:serverVariable=HTTP_TRUE_CLIENT_IP} X:${aspnet-request:serverVariable=HTTP_X_FORWARDED_FOR} R:${aspnet-request:serverVariable=REMOTE_ADDR}" />
        <field name="IPAddress" layout="T:${aspnet-request:serverVariable=HTTP_TRUE_CLIENT_IP} X:${aspnet-request:serverVariable=HTTP_X_FORWARDED_FOR} R:${aspnet-request:serverVariable=REMOTE_ADDR}" />
      </layout>
    </target>

    <target xsi:type="File" name="UrlNotFoundLog" fileName="${basedir}/logs/url-not-found.log"
            layout="${longdate} ${message}" />

    <target xsi:type="File" name="UrlRedirectionLogger" fileName="${basedir}/logs/urls-redirected.log"
            layout="${longdate} ${message}" />

    <target xsi:type="File" name="DetailsRedirectLog" fileName="${basedir}/logs/details-redirect.log"
            layout="${longdate} ${message}" />
  </targets>

  <rules>
    <logger name="Csn.Retail.Editorial.Web.Infrastructure.HystrixRestClientUtils.HystrixRestReporter" level="Trace" writeTo="RestRequestLogs" >
    </logger>
    <logger name="Csn.Retail.Editorial.Web.Features.Errors.UrlNotFoundLogger" level="Trace" writeTo="UrlNotFoundLog" final="true" /> 
    <logger name="Csn.Retail.Editorial.Web.Features.Details.DetailsRedirectLogger" level="Trace" writeTo="DetailsRedirectLog" final="true" />
    <logger name="Csn.Retail.Editorial.Web.Features.Listings.Logger.UrlRedirectionLogger" level="Trace" writeTo="UrlRedirectionLogger" final="true" />
    <logger name="*" minlevel="Trace" writeTo="FileLog" />
    <!--<logger name="*" minlevel="Warn" writeTo="FileLogCategorised" />-->
    
    <logger name="*" minLevel="Debug" writeTo="HystrixFile"/>
  </rules>
</nlog>